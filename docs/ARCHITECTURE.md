# Gumol Visualization Engine - Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           USER INTERFACE (Bevy + EGUIS)                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│
│  │ Timeline UI  │  │ Inspector UI │  │ Settings UI  │  │ Export UI    ││
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘│
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        INTERACTION LAYER                                 │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                 SELECTION & MEASUREMENT SYSTEM                    │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ Atom Picker  │  │ Distance     │  │ Angle        │          │  │
│  │  │ (Raycast)    │  │ Calculator   │  │ Calculator   │          │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                      CAMERA CONTROLS                              │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ Orbit Mode   │  │ Fly Mode     │  │ Zoom         │          │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         RENDERING LAYER (Bevy ECS)                      │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                      ENTITY COMPONENTS                             │  │
│  │                                                                   │  │
│  │  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐        │  │
│  │  │   Atom      │◄───►│   Bond      │◄───►│  Molecule   │        │  │
│  │  │ Component   │     │ Component   │     │ Component   │        │  │
│  │  └─────────────┘     └─────────────┘     └─────────────┘        │  │
│  │         │                   │                                      │  │
│  │         ▼                   ▼                                      │  │
│  │  ┌─────────────┐     ┌─────────────┐                              │  │
│  │  │ Transform   │     │ Visualization│                             │  │
│  │  │ Component   │     │ Style       │                             │  │
│  │  └─────────────┘     └─────────────┘                              │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                      RENDERING SYSTEMS                            │  │
│  │                                                                   │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ Atom Mesh    │  │ Bond Mesh    │  │ Material     │          │  │
│  │  │ Generator    │  │ Generator    │  │ System       │          │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │  │
│  │                                                                   │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │           RENDERING PIPELINE (GPU)                        │  │  │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │  │  │
│  │  │  │ Instanced│  │ Compute  │  │ Custom   │  │ Custom   │  │  │  │
│  │  │  │ Render   │  │ Shaders  │  │ Shaders  │  │ Materials│  │  │  │
│  │  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        DATA LAYER                                       │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                      TIMELINE SYSTEM                             │  │
│  │                                                                   │  │
│  │  ┌──────────────────────────────────────────────────────────┐   │  │
│  │  │          Frame 1     Frame 2     Frame 3     ...         │   │  │
│  │  │         ┌─────┐     ┌─────┐     ┌─────┐                 │   │  │
│  │  │         │Atom │◄──► │Atom │◄──► │Atom │◄───►            │   │  │
│  │  │         │Pos  │     │Pos  │     │Pos  │                 │   │  │
│  │  │         └─────┘     └─────┘     └─────┘                 │   │  │
│  │  └──────────────────────────────────────────────────────────┘   │  │
│  │                                                                   │  │
│  │  ┌──────────────────────────────────────────────────────────┐   │  │
│  │  │                 Frame Interpolation                      │   │  │
│  │  │                 (CPU or GPU Compute)                      │   │  │
│  │  └──────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                      SIMULATION DATA                             │  │
│  │                                                                   │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │  │
│  │  │ Atom Data    │  │ Bond Data    │  │ Metadata     │          │  │
│  │  │ (Elements)   │  │ (Topology)   │  │ (Residues)   │          │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘          │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        FILE I/O LAYER                                   │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    FILE PARSER MODULES                            │  │
│  │                                                                   │  │
│  │  PRIMARY FORMATS:                                                 │  │
│  │  ┌──────────────┐  ┌──────────────┐                             │  │
│  │  │  XYZ Parser  │  │  PDB Parser  │                             │  │
│  │  └──────────────┘  └──────────────┘                             │  │
│  │                                                                   │  │
│  │  SECONDARY FORMATS:                                               │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │  │
│  │  │  GRO Parser  │  │  DCD Parser  │  │ mmCIF Parser │           │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘           │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                    STREAMING & MEMORY MAPPING                    │  │
│  │                                                                   │  │
│  │  ┌──────────────────────────────────────────────────────────┐   │  │
│  │  │         Large File Support (Multi-Gigabyte)              │   │  │
│  │  │                                                           │   │  │
│  │  │  ┌──────────────┐      ┌──────────────┐                │   │  │
│  │  │  │ Memory Map   │      │ Streamed     │                │   │  │
│  │  │  │ (Fast Load)  │      │ Parser       │                │   │  │
│  │  │  └──────────────┘      └──────────────┘                │   │  │
│  │  └──────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         EXPORT LAYER                                    │
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                     EXPORT SYSTEMS                                │  │
│  │                                                                   │  │
│  │  Images:                                                          │  │
│  │  ┌──────────────┐  ┌──────────────┐                             │  │
│  │  │ Screenshot   │  │ Video (FFmpeg)│                             │  │
│  │  └──────────────┘  └──────────────┘                             │  │
│  │                                                                   │  │
│  │  3D Formats:                                                      │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │  │
│  │  │ POV-Ray      │  │ OBJ          │  │ glTF         │           │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘           │  │
│  └──────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      FILE SYSTEM (DISK)                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │
│  │   .xyz   │  │   .pdb   │  │   .gro   │  │   .dcd   │  │  .cif    │  │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │
└─────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════
                           DATA FLOW
═══════════════════════════════════════════════════════════════════════════

1. Loading Phase:
   File → Parser → Simulation Data → Atom/Bond Entities → Rendered Scene

2. Animation Phase:
   Timeline → Frame Data → Update Atom Positions → GPU Rendering

3. Interaction Phase:
   Mouse Input → Raycast → Selection → Update Highlighting → UI Update

4. Export Phase:
   Render Scene → Capture Image/3D Data → Export Format → File


═══════════════════════════════════════════════════════════════════════════
                      PERFORMANCE OPTIMIZATIONS
═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│                           GPU SIDE                                      │
│                                                                          │
│  • Instanced Rendering: Draw 10,000+ atoms in 1 draw call               │
│  • Compute Shaders: Frame interpolation on GPU                          │
│  • Frustum Culling: Skip off-screen atoms                              │
│  • Level-of-Detail: Low-poly for distant atoms                          │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                           CPU SIDE                                       │
│                                                                          │
│  • Memory Mapping: Stream trajectories without loading all to RAM       │
│  • Parallel Parsing: Multi-threaded file reading                        │
│  • Spatial Partitioning: Octree for fast raycasting                     │
│  • Cache-Friendly Data: Struct-of-Arrays layout                         │
└─────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════
                      RENDERING MODES
═══════════════════════════════════════════════════════════════════════════

CPK (Space-filling):          Ball-and-Stick:
   ●                          ●──●──●
   ●                          │  │  │
   ●                          ●──●──●

Licorice:                    Cartoon (Protein):
   ══╦═╗                      ~~~~
   ╚═╩═╝                      ~~~~

Wireframe:                   Surface:
   •──•──•                    ░░░░░░
   │  │  │                    ░░░░░░
   •──•──•                    ░░░░░░
